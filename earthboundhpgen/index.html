<!DOCTYPE html>
<html>
<link rel="icon" href="../icon.png" type="image/icon type">
<body>
<h1>Earthbound HP Scroll GIF generator</h1>
<p>Programado por porog<br>
Made with gif.js by https://jnordberg.github.io/gif.js/<br>
Earthbound Font ripped by: Jackster, reripper: Depressed Mario https://www.spriters-resource.com/snes/earthbound/sheet/37003/</p>

<canvas id="bx" width="56" height="64"></canvas>
<br>
<input type="radio" id="style1" name="styles" value="style1" checked>
<label for="style1">Estilo 1</label>
<br>

<input type="radio" id="texthp" name="textchoose" value="texthp">
<label for="male">HP</label>
<input type="radio" id="textpv" name="textchoose" value="textpv" checked>
<label for="female">PV</label><br>
<script src="gif.js"></script>
<script>
var gif = new GIF({
	transparent: 'rgba(0,0,0,0)',
	workers: 2,
	quality: 10,
	width: 56,
	height: 64
});
gif.on('finished', function(blob) {
window.open(URL.createObjectURL(blob));
});
	
var c=document.getElementById("bx");
var ctx=c.getContext("2d");
sourceimage = new Image();
sourceimage.src = 'frame1.png';
sourceimage.onload = function()
{
	ctx.drawImage(sourceimage, 0, 0);
}
var fontlib = "a";
var client = new XMLHttpRequest();
client.open('GET', 'font.txt');
client.onreadystatechange = function() {
	fontlib = client.responseText;
}
client.send();

document.write("<br>Nombre: ");
var hpname = document.createElement("INPUT");
hpname.id = "hpn";
hpname.setAttribute("type", "text");
document.body.appendChild(hpname);

document.write("<br>Número de PV inicial: ");
var initialHPbtn = document.createElement("INPUT");
initialHPbtn.setAttribute("type", "text");
document.body.appendChild(initialHPbtn);

document.write("<br>Número de PV final: ");
var finalHPbtn = document.createElement("INPUT");
finalHPbtn.setAttribute("type", "text");
document.body.appendChild(finalHPbtn);

document.write("<br>Número de PP inicial: ");
var initialPPbtn = document.createElement("INPUT");
initialPPbtn.setAttribute("type", "text");
document.body.appendChild(initialPPbtn);

document.write("<br>Número de PP final: ");
var finalPPbtn = document.createElement("INPUT");
finalPPbtn.setAttribute("type", "text");
document.body.appendChild(finalPPbtn);

document.write("<br>");
var btn = document.createElement("BUTTON");
btn.id = "bun";
btn.innerHTML = "GENERAR";  
document.body.appendChild(btn); 
btn.onclick = function()
{
	if (vibecheck() == false)
	{
		return;
	}
	document.getElementById("bun").disabled = true;
	addframe(document.getElementById("hpn").value, 0, 25);
	addframe(document.getElementById("hpn").value, 1, 25);
	addframe(document.getElementById("hpn").value, 2, 25);
	addframe(document.getElementById("hpn").value, 3, 25);
	var nl = document.createElement("div");document.body.appendChild(nl);
	var btn2 = document.createElement("BUTTON");
	btn2.innerHTML = "DESCARGAR";  
	document.body.appendChild(btn2); 
	btn2.onclick = function()
	{
		gif.render();
	}
}
function vibecheck()
{
	var vibe = true;
	
	var nameboxt = document.getElementById("hpn").value;
	for (index = 0; index < nameboxt.length; ++index)
	{
		if (fontlib.indexOf("\"" + (nameboxt.substr(index, 1).charCodeAt(0)) + "\"") == -1)
		{
			alert('Nombre tiene letra inválida: \'' + nameboxt.substr(index, 1) + '\'');
			vibe = false;
			break;
		}
	}
	return vibe;
}
function dopixel(param6, param1, param2, param3, param4, param5)
{
	param6.fillStyle = "rgb("+param3+","+param4+","+param5+","+(255/255)+")";
	param6.fillRect( param1, param2, 1, 1 );
}
function letter(param2, param1, param3, param4, param5, param6)
{	
	var focustemp = fontlib.substr(fontlib.indexOf("\"" + param5 + (param1.charCodeAt(0)) + "\"") + ("\"" + param5 + (param1.charCodeAt(0)) + "\"").length+1);
	focustemp = focustemp.substr(0, focustemp.indexOf("end"));
	focustemp = focustemp.replace(/(\r\n|\n|\r)/gm, "");
	var focus = focustemp.split(";");
	var i = 0;
	var x = param3;
	var y = param4;
	var r = 255;
	var g = 255;
	var b = 255;
	if (param6 == "black")
	{
		r = 16;
		g = 16;
		b = 16;
	}
	//document.write(fontlib);
	for (index = 0; index < focus.length; ++index)
	{
		//document.write(focus[index] + "<br>");
		for (iq = 0; iq < focus[index].length; ++iq)
		{
			if (focus[index].substr(iq, 1).charCodeAt(0) == 9608)
			{
				dopixel(param2, x + iq, y + index, r, g, b);
			}
			//dopixel(param2, x, y + index, 255, 255, 255);
		}
	}
}
function paintname(param1, param2, param3, param4, param5, param6, param7)
{
	var name = param1 + " ";
	var x = param3;
	var y = param4;
	var spacing = param7;
	var i;
	for (i = 0; i < param1.length; i++)
	{
		letter(param2, param1.substr(i, 1), param3 + (i * spacing), param4, param5, param6);
	}
}
function addframe(param1, param2, param3)
{
	var canv = document.createElement('canvas');
	canv.width=56;
	canv.height=64;
	canv.id = 'someId';
	var canvx = canv.getContext("2d");
	sourceimage = new Image();
	sourceimage.src = 'frame1.png'
	sourceimage.onload = function()
	{
		canvx.drawImage(sourceimage, 0, 0);
		paintname(param1, canvx, 10, 12, "", "white", 6);
		var hp = "" + param2;
		if (hp.length==2)
		{
			hp = " " + hp;
		}
		if (hp.length==1)
		{
			hp = "  " + hp;
		}
		paintname(hp, canvx, 26, 27, "num", "black", 8);
		
		var pp = "" + param3;
		if (pp.length==2)
		{
			pp = " " + pp;
		}
		if (hp.length==1)
		{
			pp = "  " + pp;
		}
		paintname(pp, canvx, 26, 43, "num", "black", 8);
		
		//add gif
		gif.addFrame(canvx, {copy: true, delay: 160});
	}
	document.body.appendChild(canv);
}
</script>
</body>
</html>